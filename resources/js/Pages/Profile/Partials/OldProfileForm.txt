<script setup lang="ts">
import { ref, watch } from "vue";
import { useForm } from "@inertiajs/vue3";
import { Input } from "@/Components/ui/input";
import { Label } from "@/Components/ui/label";
import { Button } from "@/Components/ui/button";

const props = defineProps({
  open: {
    type: Boolean,
    required: true,
  },
  user: {
    type: Object,
    required: true,
  },
});

const emit = defineEmits(["update:open", "update:profile"]);

// Reactive form with Inertia.js
const form = useForm({
  name: "",
  email: "",
  department: "",
});

// Sync props.user data with form
watch(
  () => props.user,
  (newUser) => {
    form.name = newUser.name || "";
    form.email = newUser.email || "";
    form.department = newUser.department || "";
  },
  { immediate: true }
);

// Handle form submission
const saveProfile = async () => {
  // Simulate form submission; replace with Inertia POST/PUT if needed
  emit("update:profile", {
    ...props.user,
    ...form,
  });

  emit("update:open", false);
};
</script>

<template>
  <GlobalModal
    padding-classes="0" v-slot="{ close }"
    panel-classes=" dark:bg-gray-800 rounded-xl"
    :close-explicitly="true"
    :close-button="false">
    <CardHeader>
      <CardTitle>
        Edit Profile
      </CardTitle>
    </CardHeader>

    <CardContent>
      <form @submit.prevent="saveProfile" class="space-y-4">
        <div>
          <Label for="name">Name</Label>
          <Input id="name" v-model="form.name" type="text" required />
        </div>

        <div>
          <Label for="email">Email</Label>
          <Input id="email" v-model="form.email" type="email" required />
        </div>

        <div>
          <FormField
            label="Department"
            placeholder="Pick a department"
            v-model="form.department"
          />
        </div>
      </form>
    </CardContent>

    <Card>
      <CardHeader>
        <CardTitle>Settings</CardTitle>
      </CardHeader>

      <CardContent>
        <!-- Notifications -->
        <div class="space-y-4">
          <h3 class="text-lg font-medium">Notifications</h3>
          <div class="flex items-center space-x-4">
            <label class="flex items-center space-x-2">
              <input
                type="checkbox"
                v-model="form.notifications.email"
                class="form-checkbox"
              />
              <span>Email</span>
            </label>
            <label class="flex items-center space-x-2">
              <input
                type="checkbox"
                v-model="form.notifications.sms"
                class="form-checkbox"
              />
              <span>SMS</span>
            </label>
          </div>
        </div>

        <!-- Timezone -->
        <div class="space-y-4 mt-6">
          <h3 class="text-lg font-medium">Timezone</h3>
          <select
            v-model="form.timezone"
            class="form-select w-full border-gray-300 rounded-md"
          >
            <option value="UTC">UTC</option>
            <option value="America/New_York">America/New_York</option>
            <option value="Europe/London">Europe/London</option>
            <!-- Add more options as needed -->
          </select>
        </div>

        <!-- Preferences -->
        <div class="space-y-4 mt-6">
          <h3 class="text-lg font-medium">Preferences</h3>
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              v-model="form.preferences.darkMode"
              class="form-checkbox"
            />
            <span>Enable Dark Mode</span>
          </label>
        </div>
      </CardContent>

      <CardFooter>
        <Button
          @click="saveSettings"
          :disabled="form.processing"
          class="w-full md:w-auto"
        >
          Save Settings
        </Button>
      </CardFooter>
    </Card>

    <CardFooter class="gap-2 justify-end">
      <Button type="button" variant="secondary" @click="close">
        Cancel
      </Button>

      <Button type="button" @click="saveProfile">
        Save Changes
      </Button>
    </CardFooter>
  </GlobalModal>
</template>
